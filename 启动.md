# 启动.md

本文档用于启动 `E:\excel_agent` 项目（前端 + 后端），并说明“识图提取”页面/接口的使用。

## 0. 环境准备

- Windows（`start.bat` 为 Windows 脚本）
- Node.js（建议 18+）
- Python（建议 3.10+，能创建 venv）

## 1. 配置大模型 Key（必须）

推荐用环境变量配置（优先级最高）：

- `ARK_API_KEY`：你的方舟/豆包 API Key
- `ARK_BASE_URL`：默认 `https://ark.cn-beijing.volces.com/api/v3`
- `ARK_MODEL_NAME`：默认 `doubao-seed-1-6-thinking-250715`

在 PowerShell 临时设置示例（仅当前窗口有效）：

```powershell
$env:ARK_API_KEY="你的key"
```

也可以直接修改 `E:\excel_agent\backend\config.py`，但不推荐把真实 key 写进代码仓库。

## 2. 一键启动（推荐）

在 `E:\excel_agent` 根目录双击运行：

- `E:\excel_agent\start.bat`

它会自动：
- 检查/创建 `backend\venv`
- 安装后端依赖 `backend\requirements.txt`
- 安装前端依赖 `frontend\node_modules`
- 启动后端 `http://localhost:8000`
- 启动前端 `http://localhost:3000`

停止方式：
- 前端窗口按 `Ctrl + C`
- 后端窗口（单独的 cmd 窗口）按 `Ctrl + C`

## 3. 手动启动（排查问题用）

### 3.1 启动后端（8000）

```powershell
cd E:\excel_agent\backend
.\venv\Scripts\activate
pip install -r requirements.txt
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 3.2 启动前端（3000）

```powershell
cd E:\excel_agent\frontend
npm install
npm run dev
```

前端通过 `E:\excel_agent\frontend\vite.config.js` 代理 `/api` 到 `http://localhost:8000`。

## 4. 识图提取（新功能）

### 4.1 前端入口

启动后打开前端：
- `http://localhost:3000`

顶部导航会有第 5 个选项：
- `识图提取`（在“搜索”右边、“常用工具”左边）

页面文件：
- `E:\excel_agent\frontend\src\components\VisionExtractPage.jsx`

### 4.2 后端接口

- `POST /api/vision/extract-text`
- `Content-Type: multipart/form-data`
- 参数：
  - `file`：图片文件
  - `prompt`：可选提示词（不传则使用默认“提取图片中的所有文字…”）

返回示例：

```json
{ "status": "success", "text": "..." }
```

后端实现文件：
- `E:\excel_agent\backend\routers\vision.py`

## 5. 常见问题

- 前端提示“请求失败/后端未启动”：确认 `http://localhost:8000/health` 能打开。
- 后端报 “ARK_API_KEY 未配置”：检查环境变量 `ARK_API_KEY` 是否生效（重开终端/重启服务）。
- 后端报 “缺少 openai 依赖”：重新执行后端依赖安装（`pip install -r requirements.txt`）。

